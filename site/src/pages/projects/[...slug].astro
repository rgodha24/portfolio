---
import { getCollection } from "astro:content";
import { Github, Globe } from "lucide-solid";
import BaseLayout from "../../layouts/BaseLayout.astro";
import TextBackground from "../../components/TextBackground.astro";
import { Markdown } from "@astropub/md";
import { getRepoReadme } from "../../github";
import pfp from "../../pfp.png";
import { Image } from "astro:assets";

export async function getStaticPaths() {
   const projects = await getCollection("projects");
   return projects.map((project) => ({
      params: { slug: project.id },
      props: project,
   }));
}
type Props = Awaited<ReturnType<typeof getStaticPaths>>[number]["props"];

const props = Astro.props;
const readme = await getRepoReadme(props.data.github);
---

<BaseLayout title={`projects: ${props.data.title}`} description={props.data.blurb}>
   <main class="min-h-screen text-sky-400" id="main">
      <!-- Text background -->
      <div class="absolute z--1">
         <TextBackground />
      </div>

      <!-- Light frosted overlay -->
      <div class="fixed inset-0 z-0 bg-#001135/50 backdrop-blur-1.5px pointer-events-none"></div>

      <!-- Header -->
      <div class="relative z-10 px-8 pt-8">
         <div class="flex flex-row gap-8 items-center md:gap-12">
            <a class="w-12 h-12 rounded-full md:w-16 md:h-16 lg:w-20 lg:h-20" href="/">
               <Image
                  src={pfp}
                  alt="my profile picture"
                  class="w-full h-full rounded-full"
                  loading="eager"
               />
            </a>
            <a href="/">
               <h1 class="font-heading text-sky-400 text-4xl md:text-5xl lg:text-7xl">
                  ROHAN GODHA
               </h1>
            </a>
         </div>
      </div>

      <!-- Content -->
      <div class="relative z-10 mx-auto max-w-4xl px-6 py-8">
         <!-- Frosted glass for content -->
         <div class="bg-#180849/50 backdrop-blur-2.5px rounded-2xl p-6 lg:p-10">
            <div class="flex items-center gap-4 mb-6">
               <h2 class="font-heading text-sky-400 text-2xl lg:text-4xl">{props.data.title}</h2>
               <div class="flex gap-3">
                  <a
                     href={`https://github.com/${props.data.github}`}
                     title="GitHub"
                     class="text-sky-400 hover:text-sky-300"
                  >
                     <Github size={24} />
                  </a>
                  {
                     !!props.data.website && (
                        <a
                           href={props.data.website}
                           title="Website"
                           class="text-sky-400 hover:text-sky-300"
                        >
                           <Globe size={24} />
                        </a>
                     )
                  }
               </div>
            </div>

            <div class="prose prose-sky-light max-w-none">
               <Markdown of={readme} />
            </div>
         </div>
      </div>
   </main>
</BaseLayout>

<style>
   .prose :global(h1:first-child) {
      @apply hidden;
   }
   .prose :global(h1),
   .prose :global(h2),
   .prose :global(h3) {
      @apply font-heading;
   }
</style>
